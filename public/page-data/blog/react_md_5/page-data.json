{"componentChunkName":"component---src-templates-blog-small-jsx","path":"/blog/react_md_5/","result":{"data":{"markdownRemark":{"html":"<h1>从零搭建一个react-hooks项目（五）</h1>\n<ul>\n<li>项目完成大概建起来了，但是当我打个生产包的时候都快哭了，一开始使用的devtool: \"source-map\"，用时高达 34 s，这当然是不可容忍的</li>\n<li>然后我们先将devtool改为\"none\"，然后发现变为了29s</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1075px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0cf0800b8cd1b8010f7ea92caf0742f3/38a65/webpack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA4klEQVQY03WO227DIBBE/TOJL8G3AIY1wQJjgh2HWFWdPKWN2v//iBK1UvtS6Wi00u7MbDT5l2FZ+skzaQlXjTAgjwc1CjWpwTNhUkSSf4hO8zr763y5Hd2CShbvcFBU8TSnQbOyiRFO8udpSAnbwK/5od2nPd+4fBw0A1MQucn2acHymm8zvE32cRoUP+cdCXGogpD7Yy4qXmFAJaWEL/Mou5430GvDhaVdR1UbACdpy6EBZb2yl7yG7/6oPUn1qvSqxzczv2sYBG8Na1WcNXZ108fg7oO56pqxomQE9N+3vwD8i0Hf7uZxMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/0cf0800b8cd1b8010f7ea92caf0742f3/38a65/webpack.png\"\n        srcset=\"/static/0cf0800b8cd1b8010f7ea92caf0742f3/0b533/webpack.png 500w,\n/static/0cf0800b8cd1b8010f7ea92caf0742f3/00d43/webpack.png 1000w,\n/static/0cf0800b8cd1b8010f7ea92caf0742f3/38a65/webpack.png 1075w\"\n        sizes=\"(max-width: 1075px) 100vw, 1075px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>分析打包速度</h2>\n<ul>\n<li>通过 <code>speed-measure-webpack-plugin</code> 分析 <code>webpack</code> 构建期间各个阶段花费的时间，使用方法如下</li>\n</ul>\n<pre><code class=\"language-js\">const SpeedMeasurePlugin = require(\"speed-measure-webpack-plugin\");\nconst smp = new SpeedMeasurePlugin();\nmodule.exports = smp.wrap(webpackConfig)\n</code></pre>\n<ul>\n<li>然后在打包时就会显示打包中各阶段花费的时间，显示如下</li>\n</ul>\n<!--more-->\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 846px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABJ0AAASdAHeZh94AAAB4ElEQVQ4y5WUWW/aQBSF+S9VE4Lx7rE93vCGgUCBAKEli9pEVbe3/v+HrwNUTdpKiXm4Gmt0/emec66mYzoxtsjoWyGWl2CockRKYAZktkTXBWeaS7fvcf77fKk6ZhASlSVZcYkb5hiGj9EXGJqHtm9SkLc99w/sNWgnq2fcPX7n9uM33q1vGVcz5oOaRZbjOCF9Q2BZAk1vOWE1uuLx609291+4f/jB9e1nxsst0+2catkQSEno+ZjWk/QXgVE2Zr19YLrYsX7/icl8i5vkpMuMdJ6iC583Xae1jx07lqSjgqJRHsoS25RYmqCvHX++eNbcSnJQDJjfbZhcLxR4RFlVDGSKa8njVFp72AEoiojhjZpwo2SOS7w8QQ8lPTNUDSrdE2BHYB7TfGioNjVJ1ZDKAZnvoxteqxD+A+puSL24JBkOiZIRaRQRB8Ffa7I/z9sC3SxidDOkXFdERY2uvNtLPcjVnha6+/y7teS6ochzCpX8fu/2CV/oJ3poSRXKakpcqwlVwuEwZX9nugmRHyBVdU+R7CRK8q6hXNUHoB3Jg2zLFAhb0PvHy1eBXhYz2c2oVyOqKxVMMzg8EmEekZYxuoKe9U6QrNkBwUDtX5whkkw9XyE99eJo7rG6J3r4C5XEAqIGpU5aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png\"\n        srcset=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/0b533/speed_measure.png 500w,\n/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png 846w\"\n        sizes=\"(max-width: 846px) 100vw, 846px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>不要在开发模式下使用这个分析插件，否则每次对代码进行修改都会导致webpack异常退出，报错 <code>Running webpack throws 'Callback was already called' error</code></li>\n</ul>\n<h2>优化一 优化解析速度 - 多进程打包</h2>\n<ul>\n<li>正常的webpack打包是单线程的，文件只能挨个处理，针对大量文件就会很慢，所以官方推荐了 thread_loader ，这个loader放在其他loader之前，，那么它后面的loader就会在单独的worker进程（node.js process）中进行</li>\n<li>thread_loader使用很简单，将它引入并放到其他loader之前即可</li>\n<li>注意：thread-loader 需要 style-loader 之后，这是因为 thread-loader 后的 loader 没法存取文件也没法获取 webpack 的选项设置。</li>\n</ul>\n<pre><code class=\"language-js\">module.exports = {\n  ...\n  module: {\n    rules: [\n      {\n        test: /\\.(ts|js)x?$/,\n        use: [\n          'thread-loader',\n          'babel-loader'\n        ],\n        exclude: /node-modules/\n      }\n    ]\n  }\n}\n</code></pre>\n<ul>\n<li>由于每个worker启动要600ms，为了防止worker启动的高延迟，我们可以进行预热</li>\n</ul>\n<pre><code class=\"language-js\">const threadLoader = require('thread-loader');\nconst jsWorkerPool = {\n  // options\n  \n  // 产生的 worker 的数量，默认是 (cpu 核心数 - 1)\n  // 当 require('os').cpus() 是 undefined 时，则为 1\n  workers: 2,\n  \n  // 闲置时定时删除 worker 进程\n  // 默认为 500ms\n  // 可以设置为无穷大， 这样在监视模式(--watch)下可以保持 worker 持续存在\n  poolTimeout: 2000\n};\nthreadLoader.warmup(jsWorkerPool, ['babel-loader']);\n\nmodule.exports = {\n  ...\n  module: {\n    rules: [\n      {\n        test: /\\.(ts|js)x?$/,\n        use: [\n          {\n            loader: 'thread-loader',\n            options: jsWorkerPool\n          },\n          'babel-loader'\n        ],\n        exclude: /node-modules/\n      }\n    ]\n  }\n}\n</code></pre>\n<ul>\n<li>然后我们再尝试打包，分析一下babel-loader的时间</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 846px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABJ0AAASdAHeZh94AAAB4ElEQVQ4y5WUWW/aQBSF+S9VE4Lx7rE93vCGgUCBAKEli9pEVbe3/v+HrwNUTdpKiXm4Gmt0/emec66mYzoxtsjoWyGWl2CockRKYAZktkTXBWeaS7fvcf77fKk6ZhASlSVZcYkb5hiGj9EXGJqHtm9SkLc99w/sNWgnq2fcPX7n9uM33q1vGVcz5oOaRZbjOCF9Q2BZAk1vOWE1uuLx609291+4f/jB9e1nxsst0+2catkQSEno+ZjWk/QXgVE2Zr19YLrYsX7/icl8i5vkpMuMdJ6iC583Xae1jx07lqSjgqJRHsoS25RYmqCvHX++eNbcSnJQDJjfbZhcLxR4RFlVDGSKa8njVFp72AEoiojhjZpwo2SOS7w8QQ8lPTNUDSrdE2BHYB7TfGioNjVJ1ZDKAZnvoxteqxD+A+puSL24JBkOiZIRaRQRB8Ffa7I/z9sC3SxidDOkXFdERY2uvNtLPcjVnha6+/y7teS6ochzCpX8fu/2CV/oJ3poSRXKakpcqwlVwuEwZX9nugmRHyBVdU+R7CRK8q6hXNUHoB3Jg2zLFAhb0PvHy1eBXhYz2c2oVyOqKxVMMzg8EmEekZYxuoKe9U6QrNkBwUDtX5whkkw9XyE99eJo7rG6J3r4C5XEAqIGpU5aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png\"\n        srcset=\"/static/9d1709d15c5d6c27b8da868781ebfb3f/0b533/speed_measure.png 500w,\n/static/9d1709d15c5d6c27b8da868781ebfb3f/5b481/speed_measure.png 846w\"\n        sizes=\"(max-width: 846px) 100vw, 846px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>我们可以看到优化了将近 9 s</li>\n</ul>\n<h2>优化二 添加公用包的缓存</h2>\n<ul>\n<li>之前我们通过将不会发生变化的三方库进行抽离为dll文件，然后二次打包的时候不再对这些文件进行打包，以此来进行打包优化</li>\n<li>不过由于webpack的升级，已经有了不差于dll的打包性能，所以我们不再考虑dll形式的打包</li>\n<li>DLL不明显了，但是有了更好的替代品 hard-source-webpack-plugin ，只需要简单引入，之后第一次打包的时候可能会慢一点，但是从第二次开始就可以看到明显的差别</li>\n<li>使用方法如下</li>\n</ul>\n<pre><code class=\"language-js\">const HardSourceWebpackPlugin = require('hard-source-webpack-plugin');\n\nmodule.exports = {\n  ...\n  plugins: [\n    new HardSourceWebpackPlugin(),\n  ],\n}\n</code></pre>\n<ul>\n<li>之后我们再来对比一下，第一次打包</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 905px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a5a839f48d274f53f61f79181e56bb4/65d79/optimize_hard_source.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABJ0AAASdAHeZh94AAABZ0lEQVQoz5WTwXKbMBRF+ZkmDRhsgwQSAhuBcUPjxMRtmCRtPVl0Ml32/zcnctpOvYTFmyeNNGfuvXrygmVKogvChebjTOBHKX4o8d06OO1dXQbJ+9mY8iKpyKsGqSxRbAhcLRcK6cDK9WyecTmbAExLy83hgZv9I5vunlXZIkSBnitMlDGbST74f4BjlHqresfw7SeH4cht/8Swf+JwfU9VbcmUoUgzkjjlYqRtr97ueXn9zfPxle8vv6i7A+XtBvvFslDqPUM/HJ+jlxUb+ocju/0zu/4RYztEVWI+Fw6YceHs/oONsiysZvO1pum3yNw9TJAyDwRXp9zC/xdHK0xKQ91/onI2TdNS25pCGMLoPLdkPFCsc5rBsr6r0HVFvMrxY8VVmE6avzOFOe3QUt01aDcyRWaQ8ZnFiVBPVobux7XLcYtetySJJpo74F+rkxUutcb2LWXXuB/jelkgYukUismwU70BXw2BEYpWaiQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/0a5a839f48d274f53f61f79181e56bb4/65d79/optimize_hard_source.png\"\n        srcset=\"/static/0a5a839f48d274f53f61f79181e56bb4/0b533/optimize_hard_source.png 500w,\n/static/0a5a839f48d274f53f61f79181e56bb4/65d79/optimize_hard_source.png 905w\"\n        sizes=\"(max-width: 905px) 100vw, 905px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>可以看到第一次的打包长中HardSourceWebpackPlugin 占了 30多s，几乎跟打包时常一样了</li>\n<li>但是当我们第二次打包的时候</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 902px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a5670f6b11f7999300161919faddbd7/58213/optimize_hard_source_after.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABW0lEQVQoz5WSWU+DQBSF+TEtZSswwLDKFFroYukiiVVbbYzG5cH4/9+Ow9i4Jg19+HInmZsz59w7kmK6MEgARffQ012BzOkcqmJ4gt6P8zEkJ07AigkIZeiTGIaTgNohGMc1fXQPj7QVlWiaYVKtkZdLeGGGwI8Q+TFMw4dhUOimB/UUh/P1DR6e37Hdv+D67gmbzQ6L1QXS8xLRIEFEfZgW/RX/qOCk2mD/+Ibd/Suubp8wmtXIVgWyOoNzFn7NtXXkQVFhfblHxZ0u6i1iNkY8ZUiXDFYQQNbc05Yiaw66qo2OYvNKBLLqiq0r/UNj47KFmBBsNuuFOZLBVMCGc9hewp2RVgL/BMN0jJLPbVHvhNhwvAJNCmhWKBbR1dzv/6n+Qfu8b1I2ND2Swf9bn0QCzQpgkhB5XmI6W0LnkVnK3bNSzNbwKEzKe/xAzNd0KAihYKM5cm6E0BQfMxBBrC7aUMYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/9a5670f6b11f7999300161919faddbd7/58213/optimize_hard_source_after.png\"\n        srcset=\"/static/9a5670f6b11f7999300161919faddbd7/0b533/optimize_hard_source_after.png 500w,\n/static/9a5670f6b11f7999300161919faddbd7/58213/optimize_hard_source_after.png 902w\"\n        sizes=\"(max-width: 902px) 100vw, 902px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>这时神奇的事发生了，我们的打包时间变得只有13s了，缩短了60%</li>\n</ul>\n<h2>优化三 vendor代码分离</h2>\n<ul>\n<li>我们发现打出来的三方库的包vendor只有一个，体积达到了 2.6 M，这样对我们的首次加载是极其不友好的</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 905px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f53ab1dd0530c86e20fa622a15fc0605/65d79/vendor_size.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABJ0AAASdAHeZh94AAAA7klEQVQoz51Rf3ODIAz1+3/FnT13tlVBQBwqSOEtYW3Xs39tucvlF3l5IVWMETlnHGXfd/RCwYedogxtLAL5/DbGGzYfkFK69+YnRnU61WjbFsuyFBBWFh4kxQCtNbz3EEOPpmkgpSx1v22w1hafwZ6AXXeFEBITFe08F5syCgulFGbKhRDg3IJpmqBoQEo/LJd1fQf8qGt8the0lw6DVHBbwOr3oudrDzFquNVD0crdIEscYoKlAdp+4Y74C8i0efI4jjDGwJDPbPh/nHPYaDVen+1KjB6NN8ox8zeG+I+8HPF40OqB/ic9sHr1vwHj0CMVGwf3sgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/f53ab1dd0530c86e20fa622a15fc0605/65d79/vendor_size.png\"\n        srcset=\"/static/f53ab1dd0530c86e20fa622a15fc0605/0b533/vendor_size.png 500w,\n/static/f53ab1dd0530c86e20fa622a15fc0605/65d79/vendor_size.png 905w\"\n        sizes=\"(max-width: 905px) 100vw, 905px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>导致vendor包过大的原因主要是我们的react组件都是同步引入的，导致webpack打包时认为是首页就需要的全部组件，从而将所有的依赖与文件都打到了一起</li>\n<li>解决这个问题我们就需要react的按需引入功能，配合webpack本身的异步分离打包实现vendor包的优化</li>\n<li>react本身支持异步导入，但是因为我们的项目使用了babel，所以我们需要确保babel可以解析异步导入语句，并能正确解析，所以引入 'babel-plugin-syntax-dynamic-import' ,使用方法如下</li>\n</ul>\n<pre><code class=\"language-js\">// 首先引入\nyarn add babel-plugin-syntax-dynamic-import -D -S\n// 然后修改 .babelrc 文件\n\"plugins\": [\n  \"syntax-dynamic-import\",\n  ...\n]\n</code></pre>\n<ul>\n<li>这样就保证我们可以正常使用react的异步导入方法了</li>\n<li>然后因为我们使用了typescript，并且配置项中的module是 es6 ，但是该模式下不支持异步导入，所以将其修改为 commonjs，如下</li>\n</ul>\n<pre><code class=\"language-js\">// tsconfig.json\n{\n  \"compilerOptions\": {\n    ...\n    \"module\": \"commonjs\", // 模块引入方式\n  }\n}\n</code></pre>\n<ul>\n<li>然后就完成了webpack基本项的配置，接下来就要修改我们的react代码</li>\n<li>我们使用react提供的 lazy 方法对组件页面进行异步引入</li>\n</ul>\n<pre><code class=\"language-js\">// 原代码\nimport * as React from 'react'\nimport Home from 'pages/home'\n\n// 异步导入\nimport * as React from 'react'\nconst { lazy } = React\nconst Home = lazy(() => import('pages/home'))\n</code></pre>\n<ul>\n<li>按这种形式将我们的所有页面引入都修改了，然后再进行打包尝试，打包后的结果如下</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 877px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8c16623f3cc19666704e5d027dcf4353/4b446/vendor_list.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABJ0AAASdAHeZh94AAAB80lEQVQ4y22TC2+bQBCE/f9/VSu1TZO0lZo2TnFjqDE2YDhe5mXzmO5cjEUMJ50SuNvhm93xwvd95HkOrr7v9eY6n89I0xR5keN0OqEsS/2cZZm+0zSNfndbt3h5WSIIgslBJZdd10UYhiiKAvZmA9O0EEXR23lVIUmSa92wFiyaJRSqOI5xPB41IYtDpTQhFz+Sy54QGoahSSaEQuB5HpSIFEWpXTiOo4kHwVlCFvHLwxoOSUV7JKrrWtNSlH0czsfOroIbe4P9hXB8WNeVFqAQaZUKtZNxDwf77wRp43A4TCyTioK0xWIKMxHq4oaEs4LbrQPP9yaCJxFkMS1SkPbYvyhS6LoeXdvOWzYtC7v9fnYoJKJF5o00vnyY77quQ9s284S8MEzuNja0y9jU8j+nStt818kdio6DfRV8Xa91HKaEl2Crt2DTOp89z0WrCdvrxCeEQRjgdukwX4LNAZEmGQilhxQs54L9Vwi3ux1q+e0WjII0upVDPnsyfSUihQimIuzL1EPpaSeFvJPODcX7eof950+wP36Af/cF8Y/vqJbPqGUHD/dI5Ln4/QvHp58IH+9lP6BZGXJniezbI3uDfiS6MFcW1n9MrJ4N/HvdwF7b8B3JmxfBsRy4tvTRVfovdxykSFUG5cdQjsSta98J/gdmnITTfyFT7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"图片\"\n        title=\"图片\"\n        src=\"/static/8c16623f3cc19666704e5d027dcf4353/4b446/vendor_list.png\"\n        srcset=\"/static/8c16623f3cc19666704e5d027dcf4353/0b533/vendor_list.png 500w,\n/static/8c16623f3cc19666704e5d027dcf4353/4b446/vendor_list.png 877w\"\n        sizes=\"(max-width: 877px) 100vw, 877px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>可以看到我们的vendor变成了 160 多k，并且将原来的大文件拆分为很多小的bundle文件，这对我们的首屏加载有很大的帮助</li>\n</ul>\n<h2>优化四 cdn引入</h2>\n<ul>\n<li>当前项目打包完成后能发现 echarts 的模块体积太大，这时我们就要对 echarts 进行cdn引入了，避免打包体积大影响我们的页面加载，如下</li>\n<li>移除 package.json 中的依赖</li>\n<li>html中新增script标签引入echarts </li>\n<li>配置webpack中的externals，使其能够正确的查找到 echarts 的依赖</li>\n</ul>\n<pre><code class=\"language-js\">// 引入cdn\n&#x3C;script src=\"https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js\">&#x3C;/script>\n\n\n// 然后修改 webpack.common.js 文件\n\"externals\": {\n  echarts: \"echarts\"\n},\n</code></pre>\n<h2>优化五 添加打包进度</h2>\n<ul>\n<li>采用依赖库 webpackbar 即可实现打包进度，</li>\n</ul>\n<pre><code class=\"language-js\">// 首先引入\nyarn add webpackbar -D\n// 然后修改 webpack.common.js 文件\nconst webpackBar = require('webpackbar')\n\nmodule.exports = {\n  ...,\n  plugins: [\n    new webpackBar({\n      name: devMode ? '启动中' : '打包中',\n      color: '#3c99b0',\n    })\n  ],\n}\n</code></pre>","frontmatter":{"title":"从零搭建一个react-hooks项目（五）","date":"2020-09-18","tags":["react","react hooks","redux","webpack"],"categories":"Webpack"},"fields":{"slug":"/react_md_5/"}}},"pageContext":{"slug":"/react_md_5/"}},"staticQueryHashes":["2566592090"]}